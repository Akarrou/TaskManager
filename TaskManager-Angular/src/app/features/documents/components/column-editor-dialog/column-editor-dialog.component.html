<h2 mat-dialog-title class="dialog-title-default">
  <mat-icon>view_column</mat-icon>
  {{ dialogTitle }}
</h2>

<mat-dialog-content class="dialog-content">
    <form [formGroup]="columnForm" class="column-form">
      <!-- Column Name -->
      <div class="c-form-group">
        <label for="column-name" class="c-form-label">
          Nom de la colonne
          <span class="c-form-label__required">*</span>
        </label>
        <input
          id="column-name"
          type="text"
          formControlName="name"
          class="c-form-input"
          [class.c-form-input--error]="columnForm.get('name')?.invalid && columnForm.get('name')?.touched"
          placeholder="Ex: Nom, Statut, Date limite"
        />
        @if (columnForm.get('name')?.hasError('required') && columnForm.get('name')?.touched) {
          <div class="c-form-error">
            <span>Le nom est requis</span>
          </div>
        }
      </div>

      <!-- Column Type -->
      <div class="c-form-group">
        <label for="column-type" class="c-form-label">
          Type de colonne
          <span class="c-form-label__required">*</span>
        </label>
        <select
          id="column-type"
          formControlName="type"
          class="c-form-input"
        >
          @for (type of columnTypes; track type.value) {
            <option [value]="type.value">
              {{ type.label }}
            </option>
          }
        </select>
      </div>

      <!-- Options for Select/Multi-Select -->
      @if (isSelectType) {
        <div class="choices-section">
          <div class="choices-header">
            <h3 class="text-sm font-medium text-gray-700">Options de sélection</h3>
            <button
              type="button"
              mat-stroked-button
              color="primary"
              (click)="addChoice()"
              class="add-choice-btn"
            >
              <mat-icon>add</mat-icon>
              Ajouter une option
            </button>
          </div>

          <div class="choices-list">
            @for (choice of choices(); track choice.id; let idx = $index) {
              <div class="choice-item">
                <div class="choice-label-field">
                  <label [for]="'choice-label-' + idx" class="c-form-label-small">Label</label>
                  <input
                    [id]="'choice-label-' + idx"
                    type="text"
                    [value]="choice.label"
                    (input)="updateChoiceLabel(choice.id, $any($event.target).value)"
                    placeholder="Nom de l'option"
                    class="c-form-input-small"
                  />
                </div>

                <div class="choice-color-field">
                  <label [for]="'choice-color-' + idx" class="c-form-label-small">Couleur</label>
                  <select
                    [id]="'choice-color-' + idx"
                    [value]="choice.color"
                    (change)="updateChoiceColor(choice.id, $any($event.target).value)"
                    class="c-form-input-small"
                  >
                    @for (color of availableColors; track color.value) {
                      <option [value]="color.value">
                        {{ color.label }}
                      </option>
                    }
                  </select>
                </div>

                <button
                  type="button"
                  mat-icon-button
                  color="warn"
                  (click)="removeChoice(choice.id)"
                  [disabled]="choices().length === 1"
                  matTooltip="Supprimer l'option"
                  class="delete-choice-btn"
                >
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            }
          </div>

          @if (choices().length === 0) {
            <div class="empty-choices">
              <p class="text-sm text-gray-500">
                Aucune option définie. Cliquez sur "Ajouter une option" pour commencer.
              </p>
            </div>
          }
        </div>
      }

      <!-- Options for Date Range -->
      @if (isDateRangeType) {
        <div class="date-range-options">
          <mat-checkbox
            [checked]="includeTime()"
            (change)="includeTime.set($event.checked)"
            class="option-checkbox"
          >
            Inclure les heures
          </mat-checkbox>
          <p class="text-xs text-gray-500 mt-1">
            Permet de définir une heure de début et de fin en plus des dates
          </p>
        </div>
      }

      <!-- Column Options -->
      <div class="column-options">
        <mat-checkbox formControlName="required" class="option-checkbox">
          Champ obligatoire
        </mat-checkbox>

        <mat-checkbox formControlName="visible" class="option-checkbox">
          Colonne visible par défaut
        </mat-checkbox>
      </div>
    </form>
  </mat-dialog-content>

<mat-dialog-actions class="dialog-actions">
  <button
    mat-button
    type="button"
    class="dialog-btn-secondary"
    (click)="onCancel()">
    <mat-icon>cancel</mat-icon>
    Annuler
  </button>

  <button
    mat-raised-button
    type="button"
    class="dialog-btn-primary"
    (click)="onSave()"
    [disabled]="!isFormValid"
    cdkFocusInitial>
    <mat-icon>{{ isEditMode() ? 'save' : 'add' }}</mat-icon>
    {{ isEditMode() ? 'Enregistrer' : 'Ajouter' }}
  </button>
</mat-dialog-actions>
