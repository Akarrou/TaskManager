<h2 mat-dialog-title class="dialog-title">
  <mat-icon>edit</mat-icon>
  <span>Modifier le nœud</span>
</h2>

<mat-dialog-content class="dialog-content">
  <mat-tab-group
    [(selectedIndex)]="activeTabIndex"
    animationDuration="200ms"
    class="editor-tabs"
  >
    <!-- Content Tab -->
    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon>text_fields</mat-icon>
        <span>Contenu</span>
      </ng-template>

      <div class="tab-content">
        <!-- Title -->
        <div class="c-form-group">
          <label for="node-title" class="c-form-label">
            Titre
            <span class="c-form-label__required">*</span>
          </label>
          <input
            id="node-title"
            type="text"
            class="c-form-input"
            [ngModel]="title()"
            (ngModelChange)="title.set($event)"
            placeholder="Titre du nœud"
            autofocus
          />
        </div>

        <!-- Description -->
        <div class="c-form-group">
          <label for="node-description" class="c-form-label">
            Description (sous-titre)
          </label>
          <textarea
            id="node-description"
            class="c-form-input c-form-textarea"
            [ngModel]="description()"
            (ngModelChange)="description.set($event)"
            placeholder="Description courte affichée sous le titre"
            rows="2"
          ></textarea>
          <p class="c-form-hint">Affiché sous le titre dans le nœud</p>
        </div>

        <!-- Formatted Content -->
        <div class="c-form-group">
          <label class="c-form-label">Notes additionnelles</label>

          <div class="formatting-toolbar">
            <button
              type="button"
              mat-icon-button
              matTooltip="Gras (**texte**)"
              (click)="applyBold()"
            >
              <mat-icon>format_bold</mat-icon>
            </button>
            <button
              type="button"
              mat-icon-button
              matTooltip="Italique (*texte*)"
              (click)="applyItalic()"
            >
              <mat-icon>format_italic</mat-icon>
            </button>
            <button
              type="button"
              mat-icon-button
              matTooltip="Liste à puces"
              (click)="addBullet()"
            >
              <mat-icon>format_list_bulleted</mat-icon>
            </button>
          </div>

          <textarea
            class="c-form-input c-form-textarea c-form-textarea--notes"
            [ngModel]="formattedContent()"
            (ngModelChange)="formattedContent.set($event)"
            placeholder="Notes, listes, informations complémentaires...&#10;&#10;• Point 1&#10;• Point 2"
            rows="5"
          ></textarea>
          <p class="c-form-hint">
            Contenu additionnel visible au survol du nœud
          </p>
        </div>
      </div>
    </mat-tab>

    <!-- Style Tab -->
    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon>palette</mat-icon>
        <span>Style</span>
      </ng-template>

      <div class="tab-content">
        <!-- Shape selector -->
        <div class="c-form-group">
          <label class="c-form-label">Forme du nœud</label>
          <app-shape-selector
            [selectedShape]="shape()"
            (shapeChange)="onShapeChange($event)"
          />
        </div>

        <!-- Background color -->
        <div class="c-form-group">
          <label class="c-form-label">Couleur de fond</label>
          <app-color-picker
            [selectedColor]="backgroundColor()"
            [showTrigger]="false"
            (colorChange)="onBackgroundColorChange($event)"
          />
        </div>

        <!-- Text color -->
        <div class="c-form-group">
          <label class="c-form-label">Couleur du texte</label>
          <div class="text-color-options">
            <button
              type="button"
              class="text-color-btn"
              [class.selected]="textColor() === '#ffffff'"
              (click)="onTextColorChange('#ffffff')"
            >
              <span class="color-swatch light"></span>
              Clair
            </button>
            <button
              type="button"
              class="text-color-btn"
              [class.selected]="textColor() === '#1f2937'"
              (click)="onTextColorChange('#1f2937')"
            >
              <span class="color-swatch dark"></span>
              Sombre
            </button>
          </div>
        </div>

        <!-- Preview -->
        <div class="c-form-group">
          <label class="c-form-label">Aperçu</label>
          <div
            class="node-preview"
            [style.backgroundColor]="backgroundColor()"
            [style.color]="textColor()"
            [class]="'shape-' + shape()"
          >
            <div class="preview-title">{{ title() || 'Titre' }}</div>
            @if (description()) {
              <div class="preview-description">{{ description() }}</div>
            }
          </div>
        </div>
      </div>
    </mat-tab>

    <!-- Size Tab -->
    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon>aspect_ratio</mat-icon>
        <span>Taille</span>
      </ng-template>

      <div class="tab-content">
        <div class="c-form-group">
          <mat-slide-toggle
            [ngModel]="autoSize()"
            (ngModelChange)="autoSize.set($event)"
            color="primary"
          >
            Taille automatique selon le contenu
          </mat-slide-toggle>
          <p class="c-form-hint">
            Ajuste automatiquement la taille du nœud en fonction du texte
          </p>
        </div>

        @if (!autoSize()) {
          <div class="size-inputs">
            <div class="c-form-group">
              <label for="node-width" class="c-form-label">Largeur (px)</label>
              <input
                id="node-width"
                type="number"
                class="c-form-input"
                [ngModel]="customWidth()"
                (ngModelChange)="customWidth.set($event)"
                min="80"
                max="400"
              />
            </div>

            <div class="c-form-group">
              <label for="node-height" class="c-form-label">Hauteur (px)</label>
              <input
                id="node-height"
                type="number"
                class="c-form-input"
                [ngModel]="customHeight()"
                (ngModelChange)="customHeight.set($event)"
                min="30"
                max="300"
              />
            </div>
          </div>
        }
      </div>
    </mat-tab>
  </mat-tab-group>
</mat-dialog-content>

<mat-dialog-actions align="end" class="dialog-actions">
  <button type="button" class="c-button c-button--secondary" (click)="cancel()">
    <span class="material-icons-outlined">close</span>
    Annuler
  </button>
  <button type="button" class="c-button c-button--primary" (click)="save()">
    <span class="material-icons-outlined">check</span>
    Enregistrer
  </button>
</mat-dialog-actions>
