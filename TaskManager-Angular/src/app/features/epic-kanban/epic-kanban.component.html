<div class="epic-kanban-container">
  
  <!-- Loading State -->
  <div *ngIf="loading$ | async" class="loading-container">
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    <p class="loading-text">Chargement de l'épic...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="(error$ | async) && !(loading$ | async)" class="error-container">
    <mat-icon class="error-icon">error</mat-icon>
    <h3>Erreur</h3>
    <p>{{ error$ | async }}</p>
    <button mat-raised-button color="primary" (click)="onRefreshBoard()">
      <mat-icon>refresh</mat-icon>
      Réessayer
    </button>
    <button mat-button (click)="onNavigateBack()">
      <mat-icon>arrow_back</mat-icon>
      Retour au tableau de bord
    </button>
  </div>

  <!-- Epic Kanban Board -->
  <div *ngIf="(currentEpic$ | async) && !(loading$ | async)" class="epic-board">
    
    <!-- Epic Header -->
    <app-epic-header 
      *ngIf="(currentEpic$ | async) && (metrics$ | async)"
      [epic]="(currentEpic$ | async)!"
      [metrics]="(metrics$ | async)!"
      [canEdit]="canEditEpic"
      (navigateBack)="onNavigateBack()"
      (refreshBoard)="onRefreshBoard()"
      (editEpic)="onEditEpic($event)"
      (saveEpic)="onSaveEpic($event)"
      (deleteEpic)="onDeleteEpic($event)"
      (exportBoard)="onExportBoard()"
      (shareBoard)="onShareBoard()">
    </app-epic-header>

    <!-- Kanban Board Content -->
    <div class="kanban-board-content">
      
      <!-- Kanban Columns Container -->
      <div class="kanban-columns-container">
        <app-kanban-column
          *ngFor="let columnData of (featuresByColumn$ | async); trackBy: trackColumn"
          [column]="columnData"
          [features]="columnData.features"
          [expandedFeatures]="expandedFeaturesSet"
          [featureTasks]="getFeatureTasksMap()"
          [isLoading]="(loading$ | async) || false"
          (featureClick)="onFeatureClick($event)"
          (featureEdit)="onFeatureEdit($event)"
          (featureDelete)="onFeatureDelete($event)"
          (toggleExpansion)="onFeatureExpand($event)"
          (taskStatusChange)="onTaskStatusChange($event)"
          class="kanban-column">
        </app-kanban-column>
      </div>

      <!-- Epic Metrics Panel (Sidebar) -->
      <div class="metrics-panel">
        <app-epic-metrics 
          *ngIf="(metrics$ | async) && (currentEpic$ | async)"
          [metrics]="(metrics$ | async)!"
          [epic]="(currentEpic$ | async)!"
          [features]="(features$ | async) || []"
          [tasks]="(tasks$ | async) || []">
        </app-epic-metrics>
      </div>

    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!(currentEpic$ | async) && !(loading$ | async) && !(error$ | async)" class="empty-state">
    <mat-icon class="empty-icon">inbox</mat-icon>
    <h3>Aucun épic trouvé</h3>
    <p>L'épic demandé n'existe pas ou n'a pas pu être chargé.</p>
    <button mat-raised-button color="primary" (click)="onNavigateBack()">
      <mat-icon>arrow_back</mat-icon>
      Retour au tableau de bord
    </button>
  </div>

</div> 