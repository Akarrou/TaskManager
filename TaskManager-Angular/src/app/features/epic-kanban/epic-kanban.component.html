<div class="epic-kanban-container">
  
  <!-- Header avec métriques -->
  <app-epic-header></app-epic-header>
  
  <!-- Section des filtres -->
  <app-search-filters></app-search-filters>
  
  <!-- Métriques en haut -->
  <app-epic-metrics 
    *ngIf="(currentEpic$ | async) && (metrics$ | async)"
    [epic]="(currentEpic$ | async)!"
    [features]="(features$ | async) || []"
    [tasks]="(tasks$ | async) || []"
    [metrics]="(metrics$ | async)!">
  </app-epic-metrics>

  <!-- État de chargement -->
  <div *ngIf="loading$ | async" class="loading-state">
    <div class="loading-content">
      <mat-icon class="loading-spinner">hourglass_empty</mat-icon>
      <span>Chargement du tableau Kanban...</span>
    </div>
  </div>

  <!-- État d'erreur -->
  <div *ngIf="error$ | async" class="error-state">
    <mat-icon class="error-icon">error_outline</mat-icon>
    <h3>Erreur de chargement</h3>
    <p>{{ error$ | async }}</p>
    <button mat-raised-button color="primary" (click)="retryLoad()">
      <mat-icon>refresh</mat-icon>
      Réessayer
    </button>
  </div>

  <!-- Tableau Kanban -->
  <div *ngIf="!(loading$ | async) && !(error$ | async)" class="epic-board">
    <div class="kanban-board-content">
      <div class="kanban-columns-container">
        <app-kanban-column
          *ngFor="let column of featuresByColumn$ | async; trackBy: trackColumn"
          [column]="column"
          [features]="column.features"
          [isLoading]="(loading$ | async) || false"
          [expandedFeatures]="expandedFeaturesSet"
          [featureTasks]="featureTasksMap"
          [connectedDropLists]="getConnectedDropLists(column.statusValue)"
          [highlightedSubtasksByFeature]="highlightedSubtasksByFeature"
          (featureClick)="onFeatureClick($event)"
          (featureEdit)="onFeatureEdit($event)"
          (featureDelete)="onFeatureDelete($event)"
          (toggleExpansion)="onFeatureExpand($event)"
          (taskStatusChange)="onTaskStatusChange($event)"
          (taskPriorityChange)="onTaskPriorityChange($event)"
          (taskEdit)="onTaskEdit($event)"
          (taskDelete)="onTaskDelete($event)"
          class="kanban-column">
        </app-kanban-column>
      </div>
    </div>
  </div>

</div> 