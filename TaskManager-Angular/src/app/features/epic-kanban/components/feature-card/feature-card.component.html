<mat-card class="feature-card" [class.expanded]="isExpanded">
  
  <!-- Feature Header -->
  <mat-card-header class="feature-header">
    
    <!-- Feature Info -->
    <div class="feature-info">
      <div class="feature-title-row">
        <span class="feature-number">#{{ feature.task_number }}</span>
        <h4 class="feature-title">{{ feature.title }}</h4>
        <mat-icon 
          class="priority-icon" 
          [style.color]="getPriorityColor(feature.priority)">
          {{ getPriorityIcon(feature.priority) }}
        </mat-icon>
      </div>
      
      <div class="feature-meta">
        <mat-chip class="status-chip" [style.background-color]="getStatusColor(feature.status)">
          {{ feature.status }}
        </mat-chip>
        <span class="task-count">{{ tasks.length }} tâche(s)</span>
      </div>
    </div>

    <!-- Feature Actions -->
    <div class="feature-actions">
      <button 
        mat-icon-button 
        [matMenuTriggerFor]="featureMenu"
        class="action-menu">
        <mat-icon>more_vert</mat-icon>
      </button>
      
      <button 
        mat-icon-button 
        (click)="onToggleExpansion()"
        class="expand-button"
        *ngIf="showTasks && tasks.length > 0">
        <mat-icon>{{ isExpanded ? 'expand_less' : 'expand_more' }}</mat-icon>
      </button>
    </div>

  </mat-card-header>

  <!-- Feature Progress -->
  <mat-card-content class="feature-content">
    <div class="progress-section" *ngIf="tasks.length > 0">
      <div class="progress-info">
        <span class="progress-label">Progression</span>
        <span class="progress-percentage">{{ getProgressPercentage() }}%</span>
      </div>
      <mat-progress-bar 
        mode="determinate" 
        [value]="getProgressPercentage()"
        class="progress-bar">
      </mat-progress-bar>
    </div>

    <!-- Feature Description -->
    <p class="feature-description" *ngIf="feature.description">
      {{ feature.description }}
    </p>

    <!-- Feature Tags -->
    <div class="feature-tags" *ngIf="feature.tags && feature.tags.length > 0">
      <mat-chip 
        *ngFor="let tag of feature.tags" 
        class="tag-chip">
        {{ tag }}
      </mat-chip>
    </div>
  </mat-card-content>

  <!-- Expanded Tasks Section -->
  <mat-card-content class="tasks-section" *ngIf="isExpanded && showTasks && tasks.length > 0">
    <h5 class="tasks-title">Tâches associées</h5>
    
    <div class="tasks-list">
      <app-task-badge
        *ngFor="let task of tasks; trackBy: trackTask"
        [task]="task"
        (click)="onTaskClicked(task)"
        class="task-item">
      </app-task-badge>
    </div>
  </mat-card-content>

</mat-card>

<!-- Feature Action Menu -->
<mat-menu #featureMenu="matMenu">
  <button mat-menu-item (click)="onEditFeature()">
    <mat-icon>edit</mat-icon>
    <span>Modifier</span>
  </button>
  <button mat-menu-item (click)="onDeleteFeature()" class="delete-action">
    <mat-icon>delete</mat-icon>
    <span>Supprimer</span>
  </button>
</mat-menu> 