@use '../../../../styles/variables' as v;
@use '../../../../styles/mixins' as m;
@use "sass:color";

// ============================================================================
// FEATURE CARD - Component Styles
// Author: TaskManager AI
// Date: 2024-07-15
// Refactor: T018 - UI Color & Style Harmonization
// ============================================================================

:host {
  display: block;
}

.feature-card {
  --card-border-color: #{v.$border-color-light};
  --card-bg-color: #{v.$background-color-form};
  --card-indicator-color: transparent;

  display: block;
  background-color: var(--card-bg-color);
  border: v.$border-width-1 solid var(--card-border-color);
  border-left: 4px solid var(--card-indicator-color);
  border-radius: v.$border-radius-md;
  box-shadow: v.$shadow-sm;
  overflow: hidden;
  transition: transform v.$transition-duration v.$transition-timing-function, 
              box-shadow v.$transition-duration v.$transition-timing-function,
              border-color v.$transition-duration v.$transition-timing-function;

  &:hover {
    transform: translateY(-2px);
    box-shadow: v.$shadow-md;
    border-color: v.$primary-color-light;
  }
  
  &:focus-visible {
    @include m.focus-ring(v.$primary-color);
  }
  
  &.dragging {
    opacity: 0.6;
    transform: rotate(1deg) translateY(-2px);
    box-shadow: v.$shadow-lg;
  }

  &.overdue {
    --card-border-color: #{v.$danger-border};
    --card-bg-color: #{v.$danger-bg};
    --card-indicator-color: #{v.$error-color};
  }

  &.has-active-tasks {
    --card-indicator-color: #{v.$warning-color};
  }

  .mat-mdc-card-header {
    padding: v.$space-3 !important;
    border-bottom: v.$border-width-1 solid v.$border-color-light;
  }

  .mat-mdc-card-content {
    padding: v.$space-3 !important;
  }
}

// ============================================================================
// HEADER ELEMENTS
// ============================================================================
.feature-card__type-badge {
  display: inline-block;
  padding: v.$space-1 v.$space-2;
  font-size: v.$font-size-xs;
  font-weight: v.$font-weight-medium;
  border-radius: v.$border-radius-sm;
  border: v.$border-width-1 solid;
}

.feature-card__task-number {
  font-family: monospace;
  font-size: v.$font-size-xs;
  color: v.$text-color-light;
}

.feature-card__actions-btn {
  color: v.$text-color-light;
  transition: color v.$transition-duration;
  &:hover {
    color: v.$text-color-dark;
  }
}

// ============================================================================
// CONTENT ELEMENTS
// ============================================================================
.feature-card__title {
  font-size: v.$font-size-base;
  font-weight: v.$font-weight-medium;
  color: v.$text-color-dark;
  margin-bottom: v.$space-2;
}

.feature-card__description {
  font-size: v.$font-size-sm;
  color: v.$text-color-medium;
  margin-bottom: v.$space-3;
  line-height: 1.5;
}

// ============================================================================
// METADATA
// ============================================================================
.feature-card__metadata {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: v.$space-3;
  font-size: v.$font-size-sm;
  color: v.$text-color-light;

  .meta-item {
    display: flex;
    align-items: center;
    gap: v.$space-1;
    
    mat-icon {
      font-size: 1rem;
    }
    
    &.meta-item--overdue {
      color: v.$error-color;
      font-weight: v.$font-weight-medium;
    }
  }
}

// ============================================================================
// PROGRESS SECTION
// ============================================================================
.progress-section {
  .progress-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: v.$space-2;

    .progress-label {
      font-size: v.$font-size-xs;
      color: v.$text-color-medium;
      font-weight: v.$font-weight-medium;
    }
  }

  .progress-actions {
    display: flex;
    align-items: center;
    gap: v.$space-2;

    .progress-count {
      font-size: v.$font-size-xs;
      font-weight: v.$font-weight-medium;
      color: v.$text-color-dark;
    }
  }

  .expand-button {
    color: v.$text-color-light;
    &:hover {
      color: v.$text-color-dark;
      background-color: rgba(v.$primary-color, 0.1);
    }
    .expand-icon.expanded {
      transform: rotate(180deg);
    }
  }

  .progress-bar {
    height: 6px !important;
    border-radius: v.$border-radius-full;
    background-color: v.$border-color-light !important;

    .mdc-linear-progress__bar-inner {
      background-color: v.$primary-color !important;
    }
    &.progress-completed .mdc-linear-progress__bar-inner {
      background-color: v.$success-color !important;
    }
    &.progress-active .mdc-linear-progress__bar-inner {
      background-color: v.$warning-color !important;
      animation: progress-pulse 2s ease-in-out infinite;
    }
  }
}

@keyframes progress-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

// ============================================================================
// TAGS
// ============================================================================
.feature-card__tags {
  display: flex;
  flex-wrap: wrap;
  gap: v.$space-1;
  margin-bottom: v.$space-1;

  .tag-chip {
    font-size: v.$font-size-xs !important;
    height: 24px !important;
    border-radius: v.$border-radius-sm !important;
    background-color: v.$background-color-light !important;
    color: v.$text-color-medium !important;
    border: 1px solid v.$border-color-light !important;
    
    &:hover {
      background-color: color.adjust(v.$background-color-light, $lightness: -2%) !important;
    }
  }

  .more-tags-indicator {
    font-size: v.$font-size-xs;
    color: v.$text-color-light;
    padding: v.$space-1 v.$space-2;
  }
}

// ============================================================================
// EXPANDED TASKS SECTION
// ============================================================================
.feature-card__tasks {
  background-color: v.$background-color-light;
  border-top: v.$border-width-1 solid v.$border-color-light;
  overflow: hidden;

  .feature-card__tasks-header {
    padding: v.$space-3;
    .feature-card__tasks-title {
      display: flex;
      align-items: center;
      gap: v.$space-2;
      font-size: v.$font-size-sm;
      font-weight: v.$font-weight-medium;
      color: v.$text-color-dark;
    }
    .feature-card__tasks-subtitle {
      font-size: v.$font-size-xs;
      color: v.$text-color-light;
      margin-top: v.$space-1;
    }
  }

  .feature-card__tasks-list {
    display: flex;
    flex-direction: column;
    gap: v.$space-2;
    padding: 0 v.$space-3 v.$space-3;
  }

  .feature-card__task-item.highlighted-task {
    background-color: rgba(v.$primary-color, 0.1);
    border-radius: v.$border-radius-md;
  }

  .feature-card__no-tasks {
    text-align: center;
    padding: v.$space-6;
    color: v.$text-color-light;
    .feature-card__no-tasks-icon {
      font-size: 2rem;
    }
  }
}

// ============================================================================
// SHARED UTILITIES (from Tailwind)
// ============================================================================
.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.sr-only {
  @include m.button-reset; // Using this as a base for hiding content accessibly
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

// ============================================================================
// RESPONSIVE DESIGN
// ============================================================================

@media (max-width: 640px) {
  .feature-card {
    .mat-mdc-card-header {
      padding: 8px !important;
    }
    
    .mat-mdc-card-content {
      padding: 8px !important;
    }
    
    .expanded-tasks-section {
      padding: 12px 8px 8px 8px !important;
    }
  }

  .progress-section {
    .progress-header {
      .progress-count {
        font-size: 11px;
      }

      .expand-button {
        width: 24px !important;
        height: 24px !important;
        min-width: 24px;

        .expand-icon {
          font-size: 16px !important;
          width: 16px !important;
          height: 16px !important;
        }
      }
    }
  }
}

// ============================================================================
// ANIMATIONS & INTERACTIONS
// ============================================================================

@keyframes card-pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.02); }
}

.feature-card:active {
  animation: card-pulse 0.2s ease-in-out;
}

// Enhanced menu styling
.feature-card-menu {
  .mat-mdc-menu-content {
    .mat-mdc-menu-item {
      transition: background-color 0.2s ease;
      
      &:hover {
        background-color: #f9fafb;
      }

      &.text-red-600 {
        color: #dc2626;

        &:hover {
          background-color: #fef2f2;
        }
      }
    }
  }
}

// Focus improvements
.expand-button:focus-visible {
  outline: none;
  box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
  border-radius: 50%;
}

// T011 - Type badge variations with improved contrast
.type-epic {
  color: v.$error-color;
  background-color: v.$danger-bg;
  border-color: v.$danger-border;
}

.type-feature {
  color: v.$primary-color;
  background-color: v.$background-color-light;
  border-color: v.$border-color-medium;
}

.type-task {
  color: v.$success-color;
  background-color: v.$background-color-light;
  border-color: v.$border-color-medium;
}

// T011 - Enhanced truncation utilities
.truncate {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.highlighted-task {
  background: #e0f2fe !important; // bleu clair
  border: 2px solid #38bdf8 !important; // bleu accent
  border-radius: 0.5rem;
  box-shadow: 0 0 0 2px #38bdf833;
  transition: background 0.2s, border 0.2s;
}

// T021 - Styles pour le highlight des sous-t√¢ches filtr√©es
.feature-card__task-item {
  transition: all 0.2s ease-in-out;
  
  &.highlighted-task {
    position: relative;
    
    // Bordure gauche jaune pour indiquer le match
    &::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      border-radius: 2px;
      z-index: 1;
    }
    
    // Fond l√©g√®rement color√©
    background: linear-gradient(90deg, rgba(251, 191, 36, 0.08), rgba(245, 158, 11, 0.04));
    border-left: 1px solid rgba(251, 191, 36, 0.2);
    
    // Animation subtile au survol
    &:hover {
      background: linear-gradient(90deg, rgba(251, 191, 36, 0.12), rgba(245, 158, 11, 0.06));
      box-shadow: 0 2px 8px rgba(251, 191, 36, 0.2);
    }
    
    // Badge "filtr√©" optionnel
    &::after {
      content: 'üîç';
      position: absolute;
      top: 4px;
      right: 4px;
      font-size: 12px;
      opacity: 0.7;
      background: rgba(251, 191, 36, 0.9);
      border-radius: 50%;
      width: 18px;
      height: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
    }
  }
}

// Animation d'apparition pour les t√¢ches filtr√©es
@keyframes highlightFadeIn {
  0% {
    background: rgba(251, 191, 36, 0.3);
    transform: scale(1.02);
  }
  100% {
    background: rgba(251, 191, 36, 0.08);
    transform: scale(1);
  }
}

.highlighted-task {
  animation: highlightFadeIn 0.6s ease-out;
} 