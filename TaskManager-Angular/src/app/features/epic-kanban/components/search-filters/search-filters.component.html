<div class="search-filters">
  
  <!-- 1. RECHERCHE GLOBALE (toujours visible et prioritaire) -->
  <div class="search-section">
    <div class="form-group">
      <label for="search-input" class="visually-hidden">Rechercher features et tâches</label>
      <div class="search-input-container">
        <mat-icon class="search-icon">search</mat-icon>
        <input 
          id="search-input"
          type="text"
          [value]="searchText()"
          (input)="onSearchChange($any($event.target).value)"
          placeholder="Rechercher : titre, numéro (#T123), tags..."
          aria-label="Rechercher dans les features et tâches">
        <button 
          *ngIf="searchText()"
          type="button"
          class="clear-search"
          (click)="clearSearch()"
          aria-label="Effacer la recherche">
          <mat-icon>clear</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- 2. FILTRES RAPIDES VISUELS (toujours visibles) -->
  <div class="quick-filters-section">
    <h3 class="quick-filters-title">
      <mat-icon>tune</mat-icon>
      Filtres rapides
    </h3>
    
    <div class="quick-filters-grid">
      <!-- Filtres Priorité -->
      <div class="filter-group">
        <span class="filter-group-label">Priorité</span>
        <div class="filter-buttons">
          <button 
            *ngFor="let option of quickPriorityFilters()" 
            type="button"
            class="quick-filter-btn"
            [class.active]="option.isActive"
            [style.--filter-color]="option.color"
            (click)="onQuickPriorityFilter(option.value)"
            [title]="option.label">
            <mat-icon class="filter-btn-icon">{{ option.icon }}</mat-icon>
            <span class="filter-btn-label">{{ option.label }}</span>
          </button>
        </div>
      </div>

      <!-- Filtres Statut -->
      <div class="filter-group">
        <span class="filter-group-label">Statut</span>
        <div class="filter-buttons">
          <button 
            *ngFor="let option of quickStatusFilters()" 
            type="button"
            class="quick-filter-btn"
            [class.active]="option.isActive"
            [style.--filter-color]="option.color"
            (click)="onQuickStatusFilter(option.value)"
            [title]="option.label">
            <mat-icon class="filter-btn-icon">{{ option.icon }}</mat-icon>
            <span class="filter-btn-label">{{ option.label }}</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 3. FILTRES AVANCÉS (expandable) -->
  <div class="advanced-filters-section">
    <button 
      type="button"
      class="advanced-filters-toggle"
      (click)="toggleExpanded()"
      [attr.aria-expanded]="isExpanded()"
      [attr.aria-label]="isExpanded() ? 'Masquer les filtres avancés' : 'Afficher les filtres avancés'">
      <mat-icon>filter_list</mat-icon>
      <span>Filtres avancés</span>
      <div class="filters-badge" *ngIf="hasAdvancedFilters()">
        {{ advancedFiltersCount() }}
      </div>
      <mat-icon class="toggle-icon">{{ isExpanded() ? 'expand_less' : 'expand_more' }}</mat-icon>
    </button>

    <div class="advanced-filters-content" [class.expanded]="isExpanded()" [class.collapsed]="!isExpanded()">
      <form class="advanced-filters-form">
        
        <div class="form-row">
          <!-- Filtre par assigné -->
          <div class="form-group">
            <label for="assigned-filter">
              <mat-icon class="field-icon">person</mat-icon>
              Assigné à
            </label>
            <select 
              id="assigned-filter"
              [value]="assigneeFilter()"
              (change)="onAssigneeChange($any($event.target).value)">
              <option value="">Tous les utilisateurs</option>
              <option value="unassigned">Non assigné</option>
              <option *ngFor="let user of availableUsers()" [value]="user.id">
                {{ user.email }}
              </option>
            </select>
          </div>

          <!-- Filtre par environnement -->
          <div class="form-group">
            <label for="environment-filter">
              <mat-icon class="field-icon">cloud</mat-icon>
              Environnement
            </label>
            <select 
              id="environment-filter"
              [value]="environmentFilter()"
              (change)="onEnvironmentChange($any($event.target).value)">
              <option value="">Tous les environnements</option>
              <option *ngFor="let option of environmentOptions" [value]="option.value">
                <span [style.color]="option.color">{{ option.icon }}</span> {{ option.label }}
              </option>
            </select>
          </div>
        </div>

        <!-- Gestion des tags -->
        <div class="form-group">
          <label for="tag-filter">
            <mat-icon class="field-icon">label</mat-icon>
            Tags
          </label>
          <select 
            id="tag-filter"
            (change)="onTagAdd($any($event.target).value); $any($event.target).value = ''">
            <option value="">Ajouter un tag...</option>
            <option *ngFor="let tag of uniqueTags()" [value]="tag">
              {{ tag }}
            </option>
          </select>
        </div>

        <!-- Tags actifs -->
        <div class="tags-active-section" *ngIf="tagsFilter().length > 0">
          <span class="tags-active-label">Tags sélectionnés :</span>
          <div class="tags-container">
            <mat-chip 
              *ngFor="let tag of tagsFilter()" 
              class="tag-chip"
              (removed)="onTagRemove(tag)">
              {{ tag }}
              <mat-icon matChipRemove>cancel</mat-icon>
            </mat-chip>
          </div>
        </div>

      </form>
    </div>
  </div>

  <!-- 4. RÉSUMÉ DES FILTRES ACTIFS -->
  <div class="active-filters-summary" *ngIf="hasActiveFilters()">
    <div class="summary-header">
      <mat-icon>filter_alt</mat-icon>
      <span class="summary-count">{{ activeFiltersCount() }} filtre(s) actif(s)</span>
      <button 
        type="button" 
        class="btn-clear-all"
        (click)="clearAllFilters()"
        title="Supprimer tous les filtres">
        <mat-icon>clear_all</mat-icon>
        <span>Tout effacer</span>
      </button>
    </div>
    
    <div class="summary-items">
      <span class="summary-item" *ngIf="searchText()">
        <mat-icon class="summary-icon">search</mat-icon>
        <span class="summary-type">Recherche:</span>
        <span class="summary-value">"{{ searchText() }}"</span>
        <button type="button" class="summary-remove" (click)="clearSearch()" title="Supprimer">
          <mat-icon>close</mat-icon>
        </button>
      </span>
      
      <span class="summary-item" *ngIf="priorityFilter()">
        <mat-icon class="summary-icon" [style.color]="getPriorityColor(priorityFilter())">
          {{ getPriorityIcon(priorityFilter()) }}
        </mat-icon>
        <span class="summary-type">Priorité:</span>
        <span class="summary-value">{{ activePriorityLabel() }}</span>
        <button type="button" class="summary-remove" (click)="onQuickPriorityFilter('')" title="Supprimer">
          <mat-icon>close</mat-icon>
        </button>
      </span>
      
      <span class="summary-item" *ngIf="statusFilter()">
        <mat-icon class="summary-icon" [style.color]="getStatusColor(statusFilter())">
          {{ getStatusIcon(statusFilter()) }}
        </mat-icon>
        <span class="summary-type">Statut:</span>
        <span class="summary-value">{{ activeStatusLabel() }}</span>
        <button type="button" class="summary-remove" (click)="onQuickStatusFilter('')" title="Supprimer">
          <mat-icon>close</mat-icon>
        </button>
      </span>
      
      <span class="summary-item" *ngIf="assigneeFilter()">
        <mat-icon class="summary-icon">person</mat-icon>
        <span class="summary-type">Assigné:</span>
        <span class="summary-value">{{ activeAssigneeLabel() }}</span>
        <button type="button" class="summary-remove" (click)="onAssigneeChange('')" title="Supprimer">
          <mat-icon>close</mat-icon>
        </button>
      </span>
      
      <span class="summary-item" *ngIf="environmentFilter()">
        <mat-icon class="summary-icon" [style.color]="getEnvironmentColor(environmentFilter())">
          cloud
        </mat-icon>
        <span class="summary-type">Environnement:</span>
        <span class="summary-value">{{ activeEnvironmentLabel() }}</span>
        <button type="button" class="summary-remove" (click)="onEnvironmentChange('')" title="Supprimer">
          <mat-icon>close</mat-icon>
        </button>
      </span>
      
      <span class="summary-item" *ngFor="let tag of tagsFilter()">
        <mat-icon class="summary-icon">label</mat-icon>
        <span class="summary-type">Tag:</span>
        <span class="summary-value">{{ tag }}</span>
        <button type="button" class="summary-remove" (click)="onTagRemove(tag)" title="Supprimer">
          <mat-icon>close</mat-icon>
        </button>
      </span>
    </div>
  </div>

</div> 