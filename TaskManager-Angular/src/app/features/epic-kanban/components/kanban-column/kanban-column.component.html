<div class="kanban-column">
  
  <!-- Column Header -->
  <div class="column-header">
    <div class="header-left">
      <mat-icon class="column-icon">{{ getColumnIcon() }}</mat-icon>
      <h3 class="column-title">{{ column.title }}</h3>
    </div>
    
    <div class="header-actions">
      <button mat-icon-button (click)="onToggleCollapse()" class="toggle-button">
        <mat-icon>{{ column.isCollapsed ? 'expand_more' : 'expand_less' }}</mat-icon>
      </button>
    </div>
  </div>

  <!-- WIP Limit Warning -->
  <div *ngIf="column.wipLimit && features.length > column.wipLimit" class="wip-warning">
    <mat-icon>warning</mat-icon>
    <span>Limite WIP dépassée ({{ features.length }}/{{ column.wipLimit }})</span>
  </div>

  <!-- Column Content -->
  <div class="column-content" 
       [class.collapsed]="column.isCollapsed"
       cdkDropList
       [id]="'column-' + column.statusValue"
       [cdkDropListData]="features"
       [cdkDropListConnectedTo]="connectedDropLists"
       (cdkDropListDropped)="onDrop($event)">
    
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <mat-icon class="spin">hourglass_empty</mat-icon>
      <span>Chargement...</span>
    </div>

    <!-- Features List -->
    <div *ngIf="!isLoading" class="features-list">
      
      <!-- Feature Cards -->
      <div *ngFor="let feature of features; trackBy: trackFeature" 
           cdkDrag
           [cdkDragData]="feature">
        
        <!-- Drag Preview (optional custom preview) -->
        <div *cdkDragPreview class="drag-preview">
          <div class="feature-preview">
            <span class="feature-number">#F{{ feature.task_number }}</span>
            <span class="feature-title">{{ feature.title }}</span>
          </div>
        </div>

        <!-- Drag Placeholder -->
        <div *cdkDragPlaceholder class="drag-placeholder">
          <div class="placeholder-content">
            <mat-icon>drag_indicator</mat-icon>
            <span>Déposer ici</span>
          </div>
        </div>

        <app-feature-card
          [feature]="feature"
          [tasks]="getFeatureTasks(feature.id!)"
          [isExpanded]="isFeatureExpanded(feature.id!)"
          [showProgress]="true"
          [highlightedTaskIds]="highlightedSubtasksByFeature[feature.id!] || []"
          (featureClick)="onFeatureClick($event)"
          (featureEdit)="onFeatureEdit($event)"
          (featureDelete)="onFeatureDelete($event)"
          (addTaskToFeature)="onAddTaskToFeature($event)"
          (toggleExpansion)="onToggleFeatureExpansion($event)"
          (taskStatusChange)="onTaskStatusChanged($event)"
          (taskPriorityChange)="onTaskPriorityChanged($event)"
          (taskEdit)="onTaskEdit($event)"
          (taskDelete)="onTaskDelete($event)">
        </app-feature-card>
      </div>

      <!-- Empty State -->
      <div *ngIf="features.length === 0 && !isLoading" class="empty-state">
        <mat-icon>inbox</mat-icon>
        <span>Aucune feature</span>
        <small class="drop-hint">Glissez une feature ici</small>
      </div>

    </div>
  </div>

</div> 