<h2 mat-dialog-title class="dialog-title-default">
  <mat-icon>task_alt</mat-icon>
  {{ data.id ? 'Modifier la sous-tâche' : 'Créer une sous-tâche' }}
</h2>

<mat-dialog-content class="dialog-content">
  <form [formGroup]="subtaskForm" class="dialog-form">
    <div class="form-row">
      <mat-form-field appearance="outline">
        <mat-label>Titre *</mat-label>
        <input matInput formControlName="title" placeholder="Titre de la sous-tâche">
        @if (subtaskForm.get('title')?.hasError('required')) {
          <mat-error>Le titre est obligatoire</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Statut *</mat-label>
        <mat-select formControlName="status">
          <mat-option value="pending">En attente</mat-option>
          <mat-option value="in_progress">En cours</mat-option>
          <mat-option value="completed">Terminée</mat-option>
          <mat-option value="cancelled">Annulée</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <mat-form-field appearance="outline">
      <mat-label>Description</mat-label>
      <textarea matInput formControlName="description" rows="3" placeholder="Décrivez la tâche en détail..."></textarea>
    </mat-form-field>

    <div class="form-row">
      <mat-form-field appearance="outline">
        <mat-label>Environnement *</mat-label>
        <mat-select formControlName="environment">
          <mat-option value="frontend">Frontend</mat-option>
          <mat-option value="backend">Backend</mat-option>
          <mat-option value="OPS">OPS</mat-option>
        </mat-select>
        @if (subtaskForm.get('environment')?.hasError('required')) {
          <mat-error>L'environnement est obligatoire</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Slug *</mat-label>
        <input matInput formControlName="slug" placeholder="slug-de-la-tache">
        @if (subtaskForm.get('slug')?.hasError('required')) {
          <mat-error>Le slug est obligatoire</mat-error>
        }
      </mat-form-field>
    </div>

    <div class="form-row">
      <mat-form-field appearance="outline">
        <mat-label>Heures estimées</mat-label>
        <input matInput type="number" formControlName="estimated_hours" min="0" step="0.1">
        <mat-icon matSuffix>schedule</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Références de guidelines</mat-label>
        <input matInput formControlName="guideline_refsInput" placeholder="ex: ref1, ref2, ref3">
        <mat-icon matSuffix>link</mat-icon>
      </mat-form-field>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions class="dialog-actions">
  <button
    type="button"
    mat-button
    class="dialog-btn-secondary"
    (click)="onCancel()">
    <mat-icon>cancel</mat-icon>
    Annuler
  </button>

  <button
    type="submit"
    mat-raised-button
    class="dialog-btn-primary"
    [disabled]="subtaskForm.invalid"
    (click)="onSave()"
    cdkFocusInitial>
    <mat-icon>{{ data.id ? 'save' : 'add' }}</mat-icon>
    {{ data.id ? 'Enregistrer' : 'Créer' }}
  </button>
</mat-dialog-actions>
