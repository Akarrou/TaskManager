<header class="header-nav">
  <div class="nav-container">
    <!-- Logo et titre -->
    <app-logo></app-logo>

    <!-- Sélecteur de projet -->
    <div class="project-selector-container" *ngIf="!isLoginPage()">
      <app-project-selector></app-project-selector>
    </div>

    <!-- Navigation principale -->
    <nav class="nav-menu" role="navigation" aria-label="Navigation principale" *ngIf="!isLoginPage()">
      <ul class="nav-list">
        <li class="nav-item">
          <a routerLink="/dashboard" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" class="nav-link">
            Dashboard
          </a>
        </li>
        <li class="nav-item">
          <a routerLink="/projects" routerLinkActive="active" class="nav-link">
            Projets
          </a>
        </li>
        <li class="nav-item">
          <a routerLink="/documents" routerLinkActive="active" class="nav-link">
            Documents
          </a>
        </li>
        <li class="nav-item">
          <a routerLink="/dashboard/tasks" routerLinkActive="active" class="nav-link">
            Tâches
          </a>
        </li>
        <li class="nav-item">
          <a routerLink="/calendar" routerLinkActive="active" class="nav-link">
            Calendrier
          </a>
        </li>
      </ul>
    </nav>

    <!-- Actions utilisateur -->
    <div class="nav-actions" *ngIf="!isLoginPage()">
      <button
        class="profile-btn"
        aria-label="Menu profil"
        title="Menu profil"
        (click)="toggleProfileMenu()">
        <div class="avatar">
          <svg viewBox="0 0 24 24" fill="currentColor" class="avatar-icon">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
          </svg>
        </div>
      </button>

      <!-- Menu déroulant profil -->
      <div class="profile-dropdown" *ngIf="showProfileMenu()">
        <ng-container *ngIf="currentUser() as user; else notConnected">
          <div class="dropdown-header">
            <div class="user-info">
              <div class="user-name">{{ user.email }}</div>
              <div class="user-email">Connecté</div>
            </div>
          </div>
          <div class="dropdown-divider"></div>
          <ul class="dropdown-menu">
            <li><a routerLink="/profile" class="dropdown-item" (click)="closeProfileMenu()">Mon profil</a></li>
            <li><button class="dropdown-item" (click)="startTour()">Visite guidée</button></li>
            <li>
              <a routerLink="/trash" class="dropdown-item" (click)="closeProfileMenu()">
                Corbeille
                @if (trashCount() > 0) {
                  <span class="trash-badge">{{ trashCount() }}</span>
                }
              </a>
            </li>
            <li class="dropdown-divider"></li>
            <li><button (click)="logout()" class="dropdown-item logout-btn">Déconnexion</button></li>
          </ul>
        </ng-container>
        <ng-template #notConnected>
          <ul class="dropdown-menu">
            <li><a routerLink="/login" class="dropdown-item">Connexion</a></li>
          </ul>
        </ng-template>
      </div>
    </div>

    <!-- Bouton menu mobile -->
    <button
      class="mobile-menu-btn"
      aria-label="Menu mobile"
      (click)="toggleMobileMenu()"
      [attr.aria-expanded]="showMobileMenu()">
      <svg class="menu-icon" viewBox="0 0 24 24" fill="currentColor">
        <path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z"/>
      </svg>
    </button>
  </div>

  <!-- Menu mobile -->
  <div class="mobile-nav" *ngIf="showMobileMenu()">
    <nav class="mobile-menu" role="navigation" aria-label="Navigation mobile">
      <ul class="mobile-nav-list">
        <li><a routerLink="/dashboard" class="mobile-nav-link" (click)="closeMobileMenu()">Dashboard</a></li>
        <li><a routerLink="/projects" class="mobile-nav-link" (click)="closeMobileMenu()">Projets</a></li>
        <li><a routerLink="/documents" class="mobile-nav-link" (click)="closeMobileMenu()">Documents</a></li>
        <li><a routerLink="/dashboard/tasks" class="mobile-nav-link" (click)="closeMobileMenu()">Tâches</a></li>
        <li><a routerLink="/calendar" class="mobile-nav-link" (click)="closeMobileMenu()">Calendrier</a></li>
        <li><a routerLink="/profile" class="mobile-nav-link" (click)="closeMobileMenu()">Profil</a></li>
      </ul>
    </nav>
  </div>
</header>
