---
description: 
globs: 
alwaysApply: false
---
---
description: Architecture du projet AgroFlow - source unique de v√©rit√© pour la structure
globs: ["**/*"]
alwaysApply: false
---

# üèõÔ∏è Architecture du Projet AgroFlow

## R√¥le & Contexte
Ce fichier est la source unique de v√©rit√© pour l‚Äôarchitecture, l‚Äôarborescence compl√®te et les patterns structurels du projet AgroFlow. Il doit √™tre r√©f√©renc√© par toutes les autres r√®gles Cursor.

Ce document centralise la **structure de r√©f√©rence** du projet AgroFlow‚ÄØ: arborescence compl√®te, conventions de dossiers, exemples, et patterns structurels. Il doit √™tre r√©f√©renc√© par toutes les r√®gles Cursor concern√©es (backend, frontend, guidelines globales).

---

## üìê Arborescence Compl√®te Backend

```text
Back/
  src/
    main/
      java/
        com/
          logicfractal/
            AgroFlow/
              config/                # Configuration Spring, s√©curit√©, CORS, etc.
              context/               # Contexte d'application (ex : s√©curit√©)
                security/
                  jwt/               # Gestion JWT
              dto/                   # Objets de transfert de donn√©es (DTO)
              dtoMapper/             # Mappers entre entit√©s et DTO
              entity/                # Entit√©s JPA (mod√®le m√©tier)
              enums/                 # √ânum√©rations m√©tiers
              exception/             # Gestion centralis√©e des exceptions
              filter/                # Filtres HTTP/S√©curit√©
              repository/            # Interfaces JPA (Spring Data)
              restController/        # Contr√¥leurs REST (endpoints)
              service/               # Logique m√©tier, organis√©e par domaine
                account/
                adress/
                company/
                customer/
                finishedProduct/
                order/
                permission/
                productionLot/
                productionOrder/
                rawMaterial/
                recipe/
                role/
                rolePermission/
                staff/
                store/
                supplier/
                supplierDelivery/
                supplierOrder/
                supplierOrderDetail/
                supplierPayment/
                user/
                userPermission/
      resources/
        db/
          migration/                 # Scripts de migration Flyway
        static/                      # Fichiers statiques (si besoin)
        templates/                   # Templates (si besoin)
    test/
      java/
        com/
          logicfractal/
            AgroFlow/
              service/               # Tests unitaires/services par domaine
                ...
      resources/                     # Ressources de test
```

---

## üì¶ Arborescence Compl√®te Frontend (Nx Workspace)

```text
Front/
  agroflow-workspace/
    apps/
      admin/                        # Application Angular principale (admin)
        src/
          app/                      # Modules et composants m√©tier (par domaine)
            account/
            company/
            dashboard/
            finished-products/
            home/
            raw-materials/
            recipes/
            stores/
            suppliers/
          assets/
            i18n/                   # Fichiers de traduction par module/composant
          styles/                   # Styles globaux
      marketplace/                  # Autre app Angular (marketplace)
      production/                   # Autre app Angular (production)
      store/                        # Autre app Angular (store)
    shared/
      core/
        src/
          lib/
            guards/
            interceptors/
            modules/
            providers/
            services/
      data-access/
        src/
          assets/
            i18n/
          lib/
            services/
            stores/
      directive/
        src/
          lib/
            permission/
            ui/
            validation/
      guards/
        auth/
        src/
          auth/
          utils/
        utils/
      i18n/
        src/
          assets/
            i18n/
          lib/
            services/
      models/
        src/
          lib/
            enums/
            interfaces/
            models/
      pipes/
        src/
          lib/
            form/
              formcontrol/
              formgroup/
      styles/
        src/
      ui/
        src/
          assets/
            i18n/
          lib/
            components/
              address/
              button/
              confirm-dialog/
              control-messages/
              custom-snackbar/
              data-table/
              header/
              help-tooltip/
              language-selector/
              login/
              logo/
              navigation-bar/
              permission-debug/
              price-input/
              route-animation/
              spinner/
              stepper/
              webcam-capture/
    scripts/
      merge-translations.js          # Script de fusion i18n
    docs/
    ...
```

---

## üßë‚Äçüíª Exemples de Patterns Structurels

- **S√©paration claire des responsabilit√©s**‚ÄØ: chaque dossier a un r√¥le pr√©cis (ex‚ÄØ: `service/` = logique m√©tier, `repository/` = acc√®s donn√©es, `restController/` = endpoints REST).
- **Convention de nommage**‚ÄØ: tout en anglais, PascalCase pour les classes, kebab-case pour les fichiers de config.
- **Tests**‚ÄØ: chaque domaine m√©tier a son dossier de tests d√©di√© sous `test/java/com/logicfractal/AgroFlow/service/`.
- **Ressources**‚ÄØ: scripts de migration Flyway dans `db/migration/`, templates et statiques s√©par√©s.
- **Frontend** :
  - **S√©paration apps/libs** : `apps/` pour les applications Angular, `libs/` pour les biblioth√®ques partag√©es (UI, core, data-access, models, i18n, etc.).
  - **Organisation par domaine** : chaque domaine m√©tier a son dossier dans `app/` (ex : `raw-materials/`, `suppliers/`).
  - **i18n** : chaque module/composant a ses propres fichiers de traduction dans `assets/i18n/`.
  - **Composants r√©utilisables** : tous les composants UI communs sont dans `shared/ui/src/lib/components/`.
  - **Styles** : styles globaux dans `styles/`, styles sp√©cifiques dans chaque composant.
  - **Scripts** : scripts utilitaires (ex : merge i18n) dans `scripts/`.

---

## üîó R√©f√©rences crois√©es

- Ce document doit √™tre r√©f√©renc√© dans‚ÄØ:
  - [41_guidelines-backend.mdc](mdc:41_guidelines-backend.mdc)
  - [40_guidelines-frontend.mdc](mdc:40_guidelines-frontend.mdc)
  - [agroflow-project-guidelines.mdc](mdc:agroflow-project-guidelines.mdc)
  - Toute r√®gle Cursor n√©cessitant la structure du projet

---

## ‚ö†Ô∏è R√àGLE AUTOMATIQUE : Mise √Ä Jour Obligatoire

**CHAQUE FOIS qu'un dossier ou fichier est cr√©√©/supprim√©/d√©plac√©**, l'IA DOIT automatiquement mettre √† jour ce fichier d'architecture.

### üîÑ **Workflow Automatique de Synchronisation**

#### üÜï **Lors de cr√©ation de nouveaux √©l√©ments** :
1. **D√©tecter automatiquement** : Nouveaux dossiers, fichiers, modules, composants
2. **Mettre √† jour l'arborescence** : Refl√©ter les changements dans les sections concern√©es
3. **Documenter les patterns** : Expliquer la logique structurelle des nouveaux √©l√©ments
4. **Valider la coh√©rence** : S'assurer que les nouveaux √©l√©ments respectent l'architecture existante

#### üóëÔ∏è **Lors de suppression d'√©l√©ments** :
1. **Supprimer de l'arborescence** : Retirer les r√©f√©rences obsol√®tes
2. **Nettoyer les r√©f√©rences crois√©es** : Mettre √† jour les liens vers les √©l√©ments supprim√©s
3. **Documenter les impacts** : Noter les implications architecturales

#### üìÅ **Lors de d√©placement/restructuration** :
1. **Refl√©ter la nouvelle organisation** : Mettre √† jour les chemins et hi√©rarchie
2. **Expliquer la logique** : Documenter les raisons du changement structurel
3. **Mettre √† jour les exemples** : Adapter les patterns et exemples

### üõ†Ô∏è **Outils de D√©tection Automatique**
- `list_dir` : Exploration syst√©matique des structures de dossiers
- `file_search` : D√©tection de nouveaux types de fichiers
- `codebase_search` : Identification de nouveaux patterns architecturaux
- Comparaison avec l'√©tat document√© pr√©c√©dent

### üìã **Format de Mise √Ä Jour Obligatoire**

Chaque modification doit inclure :
```markdown
### üîÑ Mise √Ä Jour Architecture - [Date]
**Changements d√©tect√©s** :
- ‚úÖ **Ajout√©** : [Nouveaux √©l√©ments avec chemins]
- ‚ùå **Supprim√©** : [√âl√©ments retir√©s]
- üìÅ **D√©plac√©** : [Ancienne ‚Üí Nouvelle position]

**Impact architectural** :
- [Explication de la logique structurelle]
- [Coh√©rence avec les patterns existants]
- [Implications pour les autres modules]
```

### ‚ö° **D√©clencheurs Automatiques**

Cette mise √† jour DOIT √™tre d√©clench√©e automatiquement lors de :
- Cr√©ation de nouveaux composants Angular (`ng generate component`)
- Ajout de nouveaux services, controllers, entit√©s
- Cr√©ation de nouveaux modules ou libraries
- Modification de la structure des dossiers
- Ajout de nouveaux types de fichiers (configurations, migrations, etc.)

---

## üìù Bonnes pratiques

- **Synchronisation automatique obligatoire** : Ce document DOIT √™tre mis √† jour √† chaque modification structurelle
- **Source unique de v√©rit√©** : Utiliser ce document comme r√©f√©rence absolue pour l'architecture AgroFlow
- **Documentation des patterns** : Chaque nouveau pattern doit √™tre document√© avec ses exemples
- **Coh√©rence architecturale** : Valider que chaque ajout respecte les conventions existantes
- **Tra√ßabilit√© des changements** : Maintenir un historique des √©volutions structurelles
