# ðŸ“Š Fragment de Monitoring des MÃ©triques

## ðŸŽ¯ Objectif

Standardiser la capture des mÃ©triques de performance pour permettre un monitoring et une optimisation continus du systÃ¨me de rÃ¨gles.

## ðŸ“ˆ Structure des Logs de MÃ©triques

Les logs doivent Ãªtre formatÃ©s en une seule ligne JSON pour faciliter le parsing automatique.

```json
{
  "metric_type": "rule_execution | mcp_call | validation_step",
  "name": "nom_de_la_regle_ou_etape",
  "timestamp": "ISO_8601_datetime",
  "duration_ms": 123,
  "status": "success | failure | warning",
  "context": {
    "task_id": "optional_task_id",
    "user_input": "optional_user_input_snippet",
    "details": "DÃ©tails supplÃ©mentaires"
  },
  "version": "1.0"
}
```

## ðŸ“‹ Types de MÃ©triques

### 1. ExÃ©cution de RÃ¨gle (`rule_execution`)

- **Quand** : Au dÃ©but et Ã  la fin de l'exÃ©cution d'une rÃ¨gle majeure (ex: `10_prd-builder.mdc`).
- **Exemple** :
  ```json
  {
    "metric_type": "rule_execution",
    "name": "10_prd-builder",
    "timestamp": "...",
    "duration_ms": 1850,
    "status": "success",
    "context": { "...": "..." }
  }
  ```

### 2. Appel MCP (`mcp_call`)

- **Quand** : Avant et aprÃ¨s chaque appel Ã  un outil MCP (ex: `mcp_supabase_list_projects`).
- **Exemple** :
  ```json
  {
    "metric_type": "mcp_call",
    "name": "mcp_supabase_query",
    "timestamp": "...",
    "duration_ms": 450,
    "status": "success",
    "context": { "query_snippet": "SELECT * FROM tasks..." }
  }
  ```

### 3. Ã‰tape de Validation (`validation_step`)

- **Quand** : Pour chaque Ã©tape significative de la `Validation Loop`.
- **Exemple** :
  ```json
  {
    "metric_type": "validation_step",
    "name": "linting",
    "timestamp": "...",
    "duration_ms": 3200,
    "status": "failure",
    "context": { "errors": "..." }
  }
  ```

## ðŸ”§ ImplÃ©mentation (Concept)

Une fonction helper (conceptuelle) sera utilisÃ©e pour gÃ©nÃ©rer ces logs.

```javascript
function logMetric(type, name, startTime, status, context) {
  const duration = Date.now() - startTime;
  const metric = {
    /* ... structure JSON ... */
  };
  console.log(`[METRIC] ${JSON.stringify(metric)}`);
}
```

## ðŸŽ¯ Instructions d'Utilisation

1.  **Importer** ce fragment conceptuellement dans les rÃ¨gles qui doivent Ãªtre monitorÃ©es.
2.  **Encadrer** les blocs de code Ã  mesurer avec un timer.
3.  **Appeler** la fonction `logMetric` avec les informations contextuelles appropriÃ©es.
4.  **Prioriser** les workflows critiques pour l'implÃ©mentation du monitoring.
