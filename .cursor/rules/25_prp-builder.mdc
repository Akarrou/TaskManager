# üìù G√©n√©rateur de Product Requirement Prompt (PRP Builder)

## R√¥le & Contexte

> **Monitoring :** L'ex√©cution de cette r√®gle est monitor√©e via [metrics-logger.mdc](mdc:fragments/metrics-logger.mdc).

Cet agent est sp√©cialis√© dans la cr√©ation de documents PRP pour des t√¢ches de d√©veloppement sp√©cifiques dans AgroFlow. Il ne r√©alise pas la t√¢che lui-m√™me, mais pr√©pare un "paquet d'information" complet pour qu'un autre agent (ou l'utilisateur) puisse l'ex√©cuter avec un maximum de contexte et un taux de succ√®s √©lev√© d√®s la premi√®re tentative.

Le processus est d√©clench√© par une commande utilisateur du type : `/agent-prp cr√©e un PRP pour la t√¢che #<ID_TACHE>`.

---

## ‚öôÔ∏è Processus de G√©n√©ration du PRP

### √âtape 1 : R√©cup√©ration du Contexte de la T√¢che

1.  **Interroger Supabase** :
    > **Metric Log** : `mcp_call` - `mcp_supabase_query`
    > Se connecter √† la base de donn√©es via le MCP pour r√©cup√©rer toutes les informations de la t√¢che sp√©cifi√©e (`task_number` = `<ID_TACHE>`).
    - **Fallback** : Si Supabase indisponible, rechercher dans `@/PRD/tasks-cache/*.json` en local.
    - **Champs √† r√©cup√©rer** : `title`, `description`, `acceptance_criteria` (au format Gherkin), `status`, `priority`, et l'ID du PRD parent (`prd_id`).
2.  **R√©cup√©rer le PRD associ√©** : Utiliser `prd_id` pour retrouver le fichier PRD correspondant dans le dossier `/PRD/`. Extraire les sections pertinentes (User Story, Objectifs).

### √âtape 2 : Analyse Statique du Codebase

1.  **Identifier les fichiers pertinents** : Sur la base du titre et de la description de la t√¢che, effectuer une recherche s√©mantique (`codebase_search`) pour identifier les fichiers et composants les plus susceptibles d'√™tre impact√©s par le d√©veloppement.
2.  **Extraire le contexte cl√©** : Lire le contenu des fichiers les plus importants identifi√©s √† l'√©tape pr√©c√©dente. Noter les noms des fonctions, les services, les endpoints d'API, les `Store` NGRX, etc.

### √âtape 3 : Consultation des R√®gles & de la M√©moire

1.  **Identifier les Guidelines applicables** : D√©terminer si la t√¢che concerne le `frontend`, le `backend`, ou les deux. Lister les r√®gles de d√©veloppement pertinentes (`40_guidelines-frontend.mdc`, `41_guidelines-backend.mdc`, `04-i18n.mdc`).
2.  **Rechercher des "Known Gotchas"** : Consulter la m√©moire s√©quentielle pour identifier des probl√®mes ou des bonnes pratiques sp√©cifiques √† des t√¢ches similaires d√©j√† r√©alis√©es.
    - _Exemple : "Attention, pour modifier ce composant, il faut aussi mettre √† jour les traductions et lancer le script de merge."_

---

## üìÑ Structure du Document PRP G√©n√©r√©

L'agent doit g√©n√©rer un fichier Markdown nomm√© `prp-task-<ID_TACHE>.md` en suivant rigoureusement la structure ci-dessous.

````markdown
# PRP pour la T√¢che #<ID_TACHE>: <Titre de la t√¢che>

## üéØ Goal

> (Synth√®se claire de l'objectif de la t√¢che, extraite de la description Supabase)

## ‚ùì Why

> (Contexte m√©tier extrait du PRD associ√©. Pourquoi cette t√¢che est-elle importante pour l'utilisateur ?)

## ‚úÖ Success Criteria

> (Reprendre ici les `acceptance_criteria` de Supabase, format√©s en liste de contr√¥le Gherkin)

```gherkin
Scenario: ...
  Given ...
  When ...
  Then ...
```
````

## üìö All Needed Context

### üìÑ Documentation & R√©f√©rences

- **PRD associ√©**: `[<nom_fichier_prd>](mdc:/PRD/<nom_fichier_prd>)`
- **Guidelines applicables**:
  - `[40_guidelines-frontend.mdc](mdc:.cursor/rules/40_guidelines-frontend.mdc)`
  - `[41_guidelines-backend.mdc](mdc:.cursor/rules/41_guidelines-backend.mdc)`
  - `[04-i18n.mdc](mdc:.cursor/rules/04-i18n.mdc)`

### üíª Fichiers du Codebase √† consid√©rer

> (Lister les fichiers identifi√©s lors de l'analyse statique, avec une br√®ve explication de leur pertinence)

- **Fichier** : `Front/agroflow-workspace/apps/admin/src/app/path/to/component.ts`
  **Raison** : Contient la logique m√©tier √† modifier.
- **Fichier** : `Back/src/main/java/com/logicfractal/AgroFlow/service/MyService.java`
  **Raison** : Le service qui expose les donn√©es n√©cessaires.

### ‚ö†Ô∏è Known Gotchas & Points d'attention

> (Lister ici les pi√®ges √† √©viter ou les points critiques identifi√©s)

- **CRITICAL**: Penser √† lancer `pnpm run merge-translations admin` apr√®s toute modification des fichiers i18n.
- **INFO**: Ce composant utilise un `OnPush` change detection, attention √† l'immutabilit√© des donn√©es.

## üõ†Ô∏è Implementation Blueprint (Proposition initiale)

> (L'agent propose ici une premi√®re √©bauche de plan d'action. Ce plan sera affin√© par l'agent d'ex√©cution)

1.  **Frontend**:
    - Modifier le fichier `...component.ts` pour...
    - Ajouter une nouvelle m√©thode dans `...service.ts`.
2.  **Backend**:
    - Cr√©er un nouveau DTO `...`
    - Mettre √† jour l'endpoint `...` dans `...Controller.java`.
3.  **Base de donn√©es**:
    - Cr√©er une nouvelle migration SQL pour ajouter la colonne `...`

## üîÑ Validation Loop

> **Instruction pour l'IA :** Pour cette section, vous devez lire le contenu du fichier `.cursor/rules/fragments/validation-loop-template.mdc` et l'ins√©rer ici. Ce fragment contient les √©tapes de validation standard du projet.

## ‚úÖ √âtape Finale

Une fois le fichier `.md` g√©n√©r√©, l'agent doit :

1.  Le pr√©senter √† l'utilisateur pour validation.
2.  Apr√®s validation, le sauvegarder dans un dossier `/PRPs/` √† la racine du projet.
3.  **Mettre √† jour la t√¢che dans Supabase** pour enregistrer le chemin du fichier PRP.

### Commande SQL de mise √† jour

```sql
UPDATE tasks
SET prp_path = '/PRPs/prp-task-<ID_TACHE>.md'
WHERE task_number = <ID_TACHE>;
```

```

```

```

```
