---
description: 
globs: 
alwaysApply: true
---
# 00_shared-prompts.mdc

## RÃ´le & Contexte
Ce fichier centralise les dÃ©finitions, fragments rÃ©utilisables, formats standard (YAML, JSON, Markdown, Gherkin), conventions de slug et tokens spÃ©ciaux utilisÃ©s dans toutes les rÃ¨gles Cursor AgroFlow.

---

## ğŸ§  ROUTAGE INTELLIGENT SIMPLIFIÃ‰

**INSTRUCTION CRITIQUE** : Avant toute action, analyser la demande utilisateur et appliquer automatiquement la rÃ¨gle appropriÃ©e :

| **Si la demande contient** | **Appliquer** | **Action clÃ©** |
|---------------------------|---------------|----------------|
| "nouvelle fonctionnalitÃ©" | `10_prd-builder.mdc` | CrÃ©er PRD avant tout |
| "composant Angular" | `40_guidelines-frontend.mdc` + `04-i18n.mdc` | VÃ©rifier composants existants |
| "API" / "backend" | `41_guidelines-backend.mdc` | Respecter architecture Spring |
| "tÃ¢che #123" | `30_impl-plan.mdc` | RÃ©cupÃ©rer depuis Supabase |
| "traduction" | `04-i18n.mdc` | Merge obligatoire aprÃ¨s |
| "dÃ©couper" / "tÃ¢ches" | `20_task-breakdown.mdc` | VÃ©rifier PRD validÃ© |

**RÃ¨gles prioritaires :**
1. PRD obligatoire pour nouvelle fonctionnalitÃ©
2. MCP Supabase pour toute gestion de tÃ¢ches  
3. Composants AgroFlow Ã  utiliser en prioritÃ©
4. Merge traductions obligatoire aprÃ¨s modification

---

## ğŸ“¦ DÃ©finitions et tokens

- **PRD** : Product Requirements Document, artefact contractuel validÃ©.
- **Epic** : Macro-fonctionnalitÃ©, regroupe plusieurs features.
- **Feature** : FonctionnalitÃ© mÃ©tier, module ou composant.
- **Task** : Action technique ou mÃ©tier Ã  rÃ©aliser.
- **Sub-task** : Action atomique, souvent liÃ©e Ã  un critÃ¨re d'acceptation.
- **Guideline** : RÃ¨gle de dÃ©veloppement ou de gouvernance.
- **Slug** : Identifiant unique, format kebab-case, sans accents.

---

## ğŸ“„ Formats d'artefacts

### YAML (exemple mÃ©moire long terme)
```yaml
vision: "..."
constraints:
  - "..."
kpis:
  - id: "..."
    description: "..."
```

### JSON (exemple TaskPlan)
```json
{
  "epics": [
    {
      "title": "...",
      "slug": "...",
      "features": [
        {
          "title": "...",
          "slug": "...",
          "environment": ["frontend"],
          "guideline_refs": ["FG", "PG"],
          "tasks": [
            {
              "title": "...",
              "slug": "...",
              "environment": ["frontend"],
              "guideline_refs": ["FG", "PG", "TA"],
              "subtasks": [
                {
                  "title": "...",
                  "slug": "...",
                  "environment": ["frontend"],
                  "estimated_hours": 4,
                  "guideline_refs": ["FG", "TA"]
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
```

### Markdown (exemple tableau de traÃ§abilitÃ©)
| Niveau   | Slug                         | Titre                                    | Env     | Est. |
| -------- | ---------------------------- | ---------------------------------------- | ------- | ---- |
| Epic     | gestion-roles                | Gestion des rÃ´les                        | â€“       | â€“    |
| Feature  | gestion-roles\:backend:1     | API RÃ´les                                | backend | â€“    |
| Task     | gestion-roles\:backend:1:1   | Endpoint POST /roles                     | backend | 8h   |
| Sub-task | gestion-roles\:backend:1:1:1 | ImplÃ©menter scÃ©nario Â« Ajouter un rÃ´le Â» | backend | 4h   |

### Gherkin (exemple critÃ¨re d'acceptation)
```gherkin
Scenario: Ajouter un rÃ´le
  Given je suis sur la page de gestion des rÃ´les
  When je clique sur Â« Ajouter Â» et renseigne Â« Ã©diteur Â»
  Then le rÃ´le Â« Ã©diteur Â» apparaÃ®t dans la liste
```

---

## ğŸ·ï¸ Conventions de slug

- `<slug>` : kebab-case du titre, sans accents.
- `branch` : prd/<slug>
- `commit` : PRD:<slug> | feat:<slug>
- Voir aussi : [10_prd-builder.mdc](mdc:10_prd-builder.mdc), section NORMES DE NOMENCLATURE.

---

## ğŸ“‹ Templates prÃªts Ã  l'emploi

- `prd-header.md`
- `gherkin-scenario.md`
- `risk-register.md`

---

## ğŸ”— RÃ©fÃ©rences croisÃ©es

- [10_prd-builder.mdc](mdc:10_prd-builder.mdc)
- [agroflow-project-guidelines.mdc](mdc:@agroflow-project-guidelines.mdc)

---

## ğŸš¦ Workflow sÃ©quentiel : Demande de fonctionnalitÃ© â†’ PRD â†’ TÃ¢ches

- Avant toute crÃ©ation de PRD, l'agent doit vÃ©rifier dans le dossier `@/PRD` si un PRD sur le mÃªme sujet (mÃªme slug ou sujet proche) existe dÃ©jÃ . Si oui, il doit proposer Ã  l'utilisateur de modifier le PRD existant ou d'en crÃ©er un nouveau.
- Lorsqu'un utilisateur demande la rÃ©alisation d'une nouvelle fonctionnalitÃ©, l'agent doit utiliser la rÃ¨gle [10_prd-builder.mdc](mdc:10_prd-builder.mdc) pour gÃ©nÃ©rer un document PRD structurÃ©.
- Une fois le PRD validÃ© explicitement par l'utilisateur, le document PRD doit Ãªtre enregistrÃ© dans le dossier `@/PRD` Ã  la racine du projet, en respectant le format de nommage `<slug>-YYYY-MM-DD.md`.
- AprÃ¨s validation et enregistrement du PRD, l'agent doit demander Ã  l'utilisateur s'il souhaite gÃ©nÃ©rer les tÃ¢ches associÃ©es.
- Si l'utilisateur rÃ©pond oui, l'agent doit alors utiliser la rÃ¨gle [20_task-breakdown.mdc](mdc:20_task-breakdown.mdc) pour dÃ©couper le PRD en epics, features, tasks et sub-tasks, en respectant les conventions de mapping et de traÃ§abilitÃ©.
- **Avant d'enregistrer une nouvelle tÃ¢che dans Supabase, l'agent doit vÃ©rifier si une tÃ¢che similaire (mÃªme slug ou tag PRD) existe dÃ©jÃ  et est associÃ©e Ã  la PRD en cours. Si oui, il doit proposer de modifier la tÃ¢che existante plutÃ´t que d'en crÃ©er une nouvelle.**
- **Toutes les tÃ¢ches gÃ©nÃ©rÃ©es (epics, features, tasks, sub-tasks) doivent Ãªtre enregistrÃ©es directement dans la base Supabase via le MCP Supabase, qui devient la seule source de vÃ©ritÃ© pour la gestion des tÃ¢ches. Il est interdit de sauvegarder ces tÃ¢ches uniquement sous forme de fichier JSON.**
- Ce workflow garantit la traÃ§abilitÃ© contractuelle et la cohÃ©rence entre la demande, le PRD et les tickets de dÃ©veloppement.

## âš ï¸ VÃ©rification prÃ©alable du MCP Supabase

Avant toute utilisation du MCP Supabase pour l'enregistrement des tÃ¢ches, l'agent doit vÃ©rifier que le MCP Supabase est opÃ©rationnel (connectÃ© et fonctionnel).
- Si le MCP Supabase n'est pas opÃ©rationnel, l'agent doit demander Ã  l'utilisateur d'activer le MCP.
- Si l'utilisateur ne peut pas activer le MCP, l'agent doit alors enregistrer le JSON des tÃ¢ches dans le dossier `@/PRD` pour ne pas perdre les donnÃ©es, en attendant la synchronisation ultÃ©rieure avec Supabase.

---

## ğŸ”„ Workflow sÃ©quentiel : RÃ©alisation d'une tÃ¢che

- Lorsqu'un utilisateur souhaite rÃ©aliser une tÃ¢che, il doit fournir le **numÃ©ro de la tÃ¢che** (champ `task_number` dans la base Supabase).
- L'agent rÃ©cupÃ¨re toutes les informations de la tÃ¢che et de ses sous-tÃ¢ches et commentaire associÃ©es dans Supabase.
- L'agent doit alors appliquer la rÃ¨gle [30_impl-plan.mdc](mdc:30_impl-plan.mdc) pour produire un plan d'implÃ©mentation dÃ©taillÃ© : analyse sÃ©quentielle, rÃ©flexion, plan d'action, estimation, traÃ§abilitÃ©.
- Ce plan doit Ãªtre validÃ© avant toute implÃ©mentation.
- La traÃ§abilitÃ© et la cohÃ©rence sont assurÃ©es par la mÃ©moire sÃ©quentielle et la synchronisation avec Supabase.

---

# ğŸ¤– Philosophie & Instructions Cognitives pour l'IA

## âš¡ PensÃ©e et MÃ©moire SÃ©quentielle pour le DÃ©veloppement

#### Principe Cognitif Fondamental
Avant toute crÃ©ation ou modification de fonctionnalitÃ©, l'IA doit adopter une **approche de pensÃ©e sÃ©quentielle structurÃ©e** :

1. **ğŸ§  RÃ©flexion PrÃ©alable** : Phase de comprÃ©hension profonde de la demande et de ses implications
2. **ğŸ”— Consultation de la MÃ©moire** : Recherche active des solutions, patterns et leÃ§ons antÃ©rieures
3. **ğŸ’¡ SynthÃ¨se Conceptuelle** : Construction mentale de la solution optimale
4. **âœ… Validation Architecturale** : VÃ©rification de la cohÃ©rence avec l'Ã©cosystÃ¨me AgroFlow

#### MÃ©moire SÃ©quentielle du DÃ©veloppement
L'IA doit maintenir et exploiter une **mÃ©moire cumulative** des dÃ©veloppements :

- **ğŸ—ï¸ Patterns Architecturaux ValidÃ©s** : Solutions et architectures qui ont fait leurs preuves
- **ğŸš« Anti-Patterns IdentifiÃ©s** : Approches problÃ©matiques Ã  Ã©viter absolument
- **ğŸ”§ Conventions Ã‰tablies** : Standards de code et pratiques adoptÃ©es dans le projet
- **ğŸ“ˆ Ã‰volution du Projet** : ComprÃ©hension de la trajectoire et des orientations d'AgroFlow
- **ğŸ¯ DÃ©cisions Techniques** : Historique des choix architecturaux et leurs justifications

#### Format de RÃ©flexion Obligatoire
Pour chaque dÃ©veloppement significatif, inclure une section **"ğŸ’­ Analyse DÃ©veloppement"** :

```markdown
### ğŸ’­ Analyse DÃ©veloppement

#### ğŸ§  ComprÃ©hension de la Demande
[Analyse profonde des besoins et implications]

#### ğŸ”— MÃ©moire ConsultÃ©e
- **Patterns rÃ©utilisables** : [Solutions similaires dÃ©jÃ  implÃ©mentÃ©es]
- **Conventions Ã©tablies** : [Standards dÃ©jÃ  adoptÃ©s]
- **Anti-patterns Ã©vitÃ©s** : [Erreurs Ã  ne pas reproduire]

#### ğŸ¯ Approche Conceptuelle
[Solution envisagÃ©e aprÃ¨s rÃ©flexion et justification]

#### âš ï¸ Points d'Attention
[Risques, dÃ©fis ou aspects critiques identifiÃ©s]
```

---

## ğŸ“‹ Processus de DÃ©veloppement Enrichi

Lorsque l'IA gÃ©nÃ¨re ou modifie du code pour AgroFlow, elle doit :

- **Langue de communication** : Toujours rÃ©pondre en FranÃ§ais (fr).
- **Messages de commit pour l'IA** : Toujours proposer des messages de commit en Anglais, trÃ¨s courts et descriptifs.
- **DÃ©veloppement de FonctionnalitÃ©s et Correction de Bugs avec Approche Cognitive** :
    
    **Phase Cognitive PrÃ©liminaire :**
    0. **ğŸ§  Activation de la RÃ©flexion** : Prendre un moment de "pensÃ©e silencieuse" pour comprendre profondÃ©ment la demande
    1. **ğŸ”— Consultation de la MÃ©moire SÃ©quentielle** : Rechercher activement les patterns, solutions et leÃ§ons des dÃ©veloppements antÃ©rieurs
    2. **ğŸ’¡ SynthÃ¨se Conceptuelle** : Construire mentalement l'approche optimale en capitalisant sur l'expÃ©rience accumulÃ©e
    
    **Phase de Planification Enrichie :**
    3. **ğŸ“‹ Analyse et Planification RÃ©flexive** : Analyser la demande en intÃ©grant les insights de la phase cognitive et proposer un plan dÃ©taillÃ© des Ã©tapes envisagÃ©es (approche, fichiers impactÃ©s, stratÃ©gie de test, rÃ©utilisation de patterns). Inclure obligatoirement la section "ğŸ’­ Analyse DÃ©veloppement". Si la fonctionnalitÃ© est consÃ©quente, dÃ©couper en sous-tÃ¢ches gÃ©rables.
    4. **âœ… Validation du Plan Cognitif** : Soumettre ce plan enrichi Ã  l'utilisateur pour validation avant toute implÃ©mentation.
    
    **Phase d'ImplÃ©mentation Consciente :**
    5. **ğŸ”¨ ImplÃ©mentation SÃ©quentielle GuidÃ©e** : Une fois le plan validÃ©, procÃ©der Ã©tape par Ã©tape en maintenant la continuitÃ© cognitive (rÃ©fÃ©rencer les patterns utilisÃ©s, Ã©viter les anti-patterns identifiÃ©s, informer de l'avancement Ã  chaque Ã©tape majeure).
- **Respecter les conventions avec continuitÃ© cognitive** : Appliquer les standards de nommage et de codage en capitalisant sur les conventions dÃ©jÃ  Ã©tablies et mÃ©morisÃ©es lors des dÃ©veloppements antÃ©rieurs (`@01_frontend-guidelines.mdc`, `@02_backend-guidelines.mdc`, `@04-i18n.mdc`).
- **Se rÃ©fÃ©rer aux rÃ¨gles spÃ©cifiques avec mÃ©moire** : Pour des tÃ¢ches spÃ©cialisÃ©es, consulter les rÃ¨gles dÃ©diÃ©es tout en conservant la mÃ©moire des patterns et solutions dÃ©jÃ  validÃ©s dans ces domaines.
- **Organisation du code consciente** : Organiser le code selon la structure dÃ©finie, en harmonisant avec les architectures dÃ©jÃ  implÃ©mentÃ©es et validÃ©es.
- **Performance et SÃ©curitÃ© optimisÃ©es** : Appliquer les recommandations en capitalisant sur les optimisations et mesures de sÃ©curitÃ© dÃ©jÃ  identifiÃ©es et validÃ©es dans le projet.

## ğŸ¯ Exigences Cognitives Transverses

**Comportements Cognitifs Requis :**
- **ğŸ§  Toujours commencer par la rÃ©flexion** : Aucun dÃ©veloppement sans phase de pensÃ©e prÃ©alable
- **ğŸ”— Consulter systÃ©matiquement la mÃ©moire** : Rechercher activement les Ã©lÃ©ments rÃ©utilisables
- **ğŸ’¡ Optimiser conceptuellement** : Chercher les amÃ©liorations avant l'implÃ©mentation
- **ğŸ“ˆ Maintenir la continuitÃ© Ã©volutive** : Inscrire chaque dÃ©veloppement dans la trajectoire du projet

**Comportements Cognitifs Interdits :**
- **ğŸš« DÃ©velopper sans rÃ©flexion** : Jamais d'implÃ©mentation directe sans phase cognitive
- **ğŸš« Ignorer l'expÃ©rience acquise** : Ne pas reproduire des solutions dÃ©jÃ  optimisÃ©es
- **ğŸš« CrÃ©er sans cohÃ©rence** : Ã‰viter les architectures qui rompent l'harmonie du projet
- **ğŸš« RÃ©pÃ©ter les erreurs passÃ©es** : Ne pas reproduire les anti-patterns identifiÃ©s
